<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Orders — TallySync Manager</title>
  <link rel="stylesheet" href="../assets/css/main.css">
</head>
<body>
<div id="page-content">

  <div class="page-header">
    <h1>Orders</h1>
    <div class="page-actions">
      <button class="btn btn-outline" id="btn-export-orders">
        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></svg>
        Export
      </button>
      <button class="btn btn-primary" id="btn-new-order">
        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14"/><path d="M12 5v14"/></svg>
        New Order
      </button>
    </div>
  </div>

  <!-- Filters -->
  <div class="filter-bar">
    <div class="search-wrap">
      <span class="search-icon">
        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>
      </span>
      <input type="text" id="order-search" class="form-control" placeholder="Search by party name…">
    </div>
    <select id="order-type-filter" class="filter-select">
      <option value="">All Types</option>
      <option value="SALES">Sales</option>
      <option value="PURCHASE">Purchase</option>
    </select>
    <select id="order-status-filter" class="filter-select">
      <option value="">All Statuses</option>
      <option value="DRAFT">Draft</option>
      <option value="CONFIRMED">Confirmed</option>
      <option value="PUSHED">Pushed</option>
      <option value="CANCELLED">Cancelled</option>
    </select>
    <input type="date" id="order-from">
    <input type="date" id="order-to">
  </div>

  <!-- Table -->
  <div class="table-wrap">
    <table>
      <thead><tr>
        <th>Order #</th><th>Type</th><th>Date</th><th>Party</th>
        <th class="text-right">Amount</th><th>Status</th>
        <th>Tally Voucher</th><th>Actions</th>
      </tr></thead>
      <tbody id="orders-table-body"><tr><td colspan="8" style="padding:2.5rem;text-align:center;"><span class="spinner"></span></td></tr></tbody>
    </table>
  </div>
</div>

<!-- New / Edit Order Modal -->
<div class="modal-overlay" id="order-modal" style="align-items:flex-start;padding-top:2rem;overflow-y:auto;">
  <div class="modal" style="width:46rem;max-width:96vw;margin:auto;">
    <div class="modal-header">
      <div>
        <div class="modal-title" id="order-modal-title">New Order</div>
        <div class="modal-desc">Fill in order details and add line items</div>
      </div>
      <button class="btn-icon" onclick="closeModal('order-modal')">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
      </button>
    </div>
    <div class="modal-body">
      <input type="hidden" id="edit-order-id">

      <div class="form-grid">
        <div class="form-group">
          <label class="form-label">Order Type</label>
          <select id="order-type" class="form-control">
            <option value="SALES">Sales Order</option>
            <option value="PURCHASE">Purchase Order</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">Order Date</label>
          <input type="date" id="order-date" class="form-control">
        </div>
      </div>

      <div class="form-group">
        <label class="form-label">Party Name</label>
        <input type="text" id="order-party" class="form-control" list="party-datalist" placeholder="Type party name…">
        <datalist id="party-datalist"></datalist>
      </div>
      <div class="form-group">
        <label class="form-label">Narration <span class="text-muted text-xs">(optional)</span></label>
        <textarea id="order-narration" class="form-control" rows="2" placeholder="Add a note…"></textarea>
      </div>

      <!-- Items -->
      <div class="flex-between" style="margin-bottom:0.625rem;">
        <span class="fw-600 text-sm">Line Items</span>
        <button class="btn btn-outline btn-sm" id="btn-add-item">+ Add Row</button>
      </div>
      <div class="table-wrap" style="margin-bottom:0.875rem;">
        <table>
          <thead><tr>
            <th>Item Name</th><th>UOM</th>
            <th class="text-right">Qty</th>
            <th class="text-right">Rate (₹)</th>
            <th class="text-right">Amount (₹)</th>
            <th></th>
          </tr></thead>
          <tbody id="order-items-body"></tbody>
        </table>
      </div>

      <div class="flex-between" style="padding: 0.625rem 0; border-top: 1px solid var(--border);">
        <span class="text-muted text-sm">Total</span>
        <span class="amount fw-700" id="order-total" style="font-size:1.0625rem;">₹0.00</span>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-outline" onclick="closeModal('order-modal')">Cancel</button>
      <button class="btn btn-secondary" id="btn-save-draft">Save Draft</button>
      <button class="btn btn-primary"   id="btn-save-confirm">Confirm Order</button>
    </div>
  </div>
</div>

<!-- Item row template -->
<template id="order-item-row-tpl">
  <tr class="order-item-row">
    <td><input type="text" class="form-control item-name" list="stock-datalist" placeholder="Item name…"></td>
    <td><input type="text" class="form-control item-uom" placeholder="Nos" style="width:5rem;"></td>
    <td><input type="number" class="form-control item-qty text-right" min="0.01" step="0.01" style="width:6rem;"></td>
    <td><input type="number" class="form-control item-rate text-right" min="0.01" step="0.01" style="width:7.5rem;"></td>
    <td class="text-right amount item-amount">0.00</td>
    <td>
      <button class="btn-icon sm btn-remove-item" title="Remove row">
        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
      </button>
    </td>
  </tr>
</template>
<datalist id="stock-datalist"></datalist>

<script src="../assets/js/config.js"></script>
<script src="../assets/js/api.js"></script>
<script src="../assets/js/utils.js"></script>
<script src="../assets/js/custom-select.js"></script>
<script src="../assets/js/date-picker.js"></script>
<script src="../assets/js/sync.js"></script>
<script src="../assets/js/layout.js"></script>
<script src="../assets/js/pages/orders.js"></script>
<script>
  injectLayout('Orders');
  initOrders();
  CustomSelect.init('order-type-filter');
  CustomSelect.init('order-status-filter');
  CustomSelect.init('order-type');
  DatePicker.init('order-from', { placeholder: 'From date' });
  DatePicker.init('order-to',   { placeholder: 'To date' });
  window.addEventListener('company:changed', initOrders);
</script>
</body>
</html>
