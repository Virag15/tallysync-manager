<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Settings â€” TallySync Manager</title>
  <link rel="stylesheet" href="../assets/css/main.css">
</head>
<body>
<div id="page-content">

  <div class="page-header">
    <h1>Settings</h1>
    <div class="page-actions">
      <button class="btn btn-outline" id="btn-guide">
        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><path d="M12 17h.01"/></svg>
        Connection Guide
      </button>
      <button class="btn btn-primary" id="btn-add-company">
        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14"/><path d="M12 5v14"/></svg>
        Add Company
      </button>
    </div>
  </div>

  <!-- App Info -->
  <div class="card" style="margin-bottom:1rem;">
    <div class="card-header">
      <div class="card-title">Application Info</div>
    </div>
    <div class="card-body">
      <div class="form-grid" style="grid-template-columns:repeat(4,1fr);margin-bottom:1rem;">
        <div>
          <div class="form-label text-muted">Application</div>
          <div id="info-name" class="fw-600">â€”</div>
        </div>
        <div>
          <div class="form-label text-muted">Version</div>
          <div id="info-version" class="mono">â€”</div>
        </div>
        <div>
          <div class="form-label text-muted">Build</div>
          <div id="info-build" class="mono">â€”</div>
        </div>
        <div>
          <div class="form-label text-muted">Database</div>
          <div id="info-db" class="mono text-xs text-muted" style="word-break:break-all;">â€”</div>
        </div>
      </div>
      <div style="display:flex;gap:0.75rem;align-items:flex-end;flex-wrap:wrap;">
        <div style="flex:1;min-width:14rem;">
          <label class="form-label">Backend Server URL</label>
          <input type="text" id="backend-url" class="form-control" placeholder="http://localhost:8001">
          <div class="form-hint">Where the TallySync Python server is running. Saved in your browser.</div>
        </div>
        <div style="flex:1;min-width:14rem;">
          <label class="form-label">API Key</label>
          <div style="display:flex;gap:0.5rem;">
            <input type="password" id="api-key" class="form-control mono" placeholder="Loaded from serverâ€¦" autocomplete="off">
            <button class="btn btn-ghost btn-sm" id="btn-toggle-key" title="Show/hide key" style="padding:0 0.5rem;">
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"/><circle cx="12" cy="12" r="3"/></svg>
            </button>
            <button class="btn btn-ghost btn-sm" id="btn-copy-key" title="Copy key">
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="14" height="14" x="8" y="8" rx="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/></svg>
            </button>
          </div>
          <div class="form-hint">Auto-loaded from your server. Paste here to save in browser.</div>
        </div>
        <button class="btn btn-primary" id="btn-save-connection" style="margin-bottom:1.6rem;">Save</button>
      </div>
    </div>
  </div>

  <!-- Launchers -->
  <div class="card" style="margin-bottom:1rem;">
    <div class="card-header">
      <div>
        <div class="card-title">Quick Start Launchers</div>
        <div class="card-desc">One click to start TallySync â€” no terminal needed</div>
      </div>
      <a href="https://github.com/Virag15/tallysync-manager/releases" target="_blank" rel="noopener"
         class="btn btn-outline btn-sm" style="white-space:nowrap">
        <svg xmlns="http://www.w3.org/2000/svg" width="13" height="13" viewBox="0 0 24 24" fill="none"
             stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
          <polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/>
        </svg>
        Download
      </a>
    </div>
    <div class="card-body" style="padding-top:0;">
      <div class="launcher-grid">

        <!-- macOS -->
        <div class="launcher-card" id="launcher-mac">
          <div class="launcher-icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none"
                 stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
              <path d="M12 20.94c1.5 0 2.75 1.06 4 1.06 3 0 6-8 6-12.22A4.91 4.91 0 0 0 17 5c-2.22 0-4 1.44-5 2-1-.56-2.78-2-5-2a4.9 4.9 0 0 0-5 4.78C2 13.72 5 22 8 22c1.25 0 2.5-1.06 4-1.06z"/>
              <path d="M10 2c1 .5 2 2 2 5"/>
            </svg>
          </div>
          <div class="launcher-content">
            <div class="launcher-title">macOS â€” TallySync.app</div>
            <div class="launcher-desc">Double-click the app to start everything automatically.</div>
            <ol class="launcher-steps">
              <li>Download and unzip the TallySync package</li>
              <li>Drag <strong>TallySync.app</strong> to your <strong>Applications</strong> folder</li>
              <li><strong>First time:</strong> right-click â†’ <strong>Open</strong> â†’ Open again</li>
              <li>After that, just double-click to launch</li>
            </ol>
          </div>
          <button class="btn btn-outline btn-sm launcher-detail-btn" onclick="openModal('launcher-mac-modal')">How to set up â†’</button>
        </div>

        <!-- Windows -->
        <div class="launcher-card" id="launcher-win">
          <div class="launcher-icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none"
                 stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
              <rect x="2" y="3" width="20" height="14" rx="2"/><path d="M8 21h8"/><path d="M12 17v4"/>
            </svg>
          </div>
          <div class="launcher-content">
            <div class="launcher-title">Windows â€” start.bat</div>
            <div class="launcher-desc">Double-click the batch file to start both servers and open the dashboard.</div>
            <ol class="launcher-steps">
              <li>Download and unzip the TallySync package</li>
              <li>Open the <strong>setup\</strong> folder</li>
              <li>Double-click <strong>start.bat</strong></li>
              <li><em>Optional:</em> right-click â†’ <strong>Send to â†’ Desktop (shortcut)</strong></li>
            </ol>
          </div>
          <button class="btn btn-outline btn-sm launcher-detail-btn" onclick="openModal('launcher-win-modal')">How to set up â†’</button>
        </div>

      </div>

      <!-- Auto-start badge -->
      <div class="launcher-autostart-note">
        <svg xmlns="http://www.w3.org/2000/svg" width="13" height="13" viewBox="0 0 24 24" fill="none"
             stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/>
        </svg>
        For auto-start on login (so TallySync launches automatically when you turn on your computer),
        run <code>setup/install-autostart-macos.sh</code> (Mac) or
        <code>setup\install-autostart-windows.bat</code> (Windows) once.
      </div>
    </div>
  </div>

  <!-- Companies -->
  <div class="card">
    <div class="card-header">
      <div>
        <div class="card-title">Tally Companies</div>
        <div class="card-desc">Manage Tally Prime instances and sync settings</div>
      </div>
    </div>
    <div class="table-wrap" style="border:none;border-radius:0 0 var(--radius) var(--radius);">
      <table>
        <thead><tr>
          <th>Name</th><th>Tally Company</th><th>Host</th><th>Port</th>
          <th>Sync Interval</th><th>Last Synced</th><th>Status</th><th>Actions</th>
        </tr></thead>
        <tbody id="companies-table"><tr><td colspan="8" style="padding:2.5rem;text-align:center;"><span class="spinner"></span></td></tr></tbody>
      </table>
    </div>
  </div>

</div>

<!-- Add / Edit Company Modal -->
<div class="modal-overlay" id="company-modal">
  <div class="modal">
    <div class="modal-header">
      <div>
        <div class="modal-title" id="company-modal-title">Add Company</div>
        <div class="modal-desc">Configure a Tally Prime instance</div>
      </div>
      <button class="btn-icon" onclick="closeModal('company-modal')">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
      </button>
    </div>
    <div class="modal-body">
      <input type="hidden" id="edit-company-id">
      <div class="form-group">
        <label class="form-label">Display Name</label>
        <input type="text" id="company-name" class="form-control" placeholder="My Company">
      </div>
      <div class="form-group">
        <label class="form-label">Tally Company Name
          <span class="text-muted text-xs">(exact name as in Tally)</span>
        </label>
        <input type="text" id="company-tally-name" class="form-control" placeholder="ABC Trading Co.">
      </div>
      <div class="form-grid">
        <div class="form-group">
          <label class="form-label">Host / IP</label>
          <input type="text" id="company-host" class="form-control" placeholder="localhost" value="localhost">
        </div>
        <div class="form-group">
          <label class="form-label">Port</label>
          <input type="number" id="company-port" class="form-control" value="9000" min="1" max="65535">
        </div>
      </div>
      <div class="form-group">
        <label class="form-label">Sync Interval (minutes)</label>
        <input type="number" id="company-interval" class="form-control" value="5" min="1" max="1440">
        <div class="form-hint">How often to pull data from Tally automatically</div>
      </div>

      <div id="test-result" style="display:none;padding:0.75rem;border-radius:calc(var(--radius) - 4px);margin-top:0.5rem;font-size:0.8125rem;border:1px solid var(--border);"></div>
    </div>
    <div class="modal-footer" style="flex-wrap:wrap;gap:0.5rem;">
      <button class="btn btn-ghost btn-sm" id="btn-test-conn">
        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12.55a11 11 0 0 1 14.08 0"/><path d="M1.42 9a16 16 0 0 1 21.16 0"/><path d="M8.53 16.11a6 6 0 0 1 6.95 0"/><circle cx="12" cy="20" r="1"/></svg>
        Test Connection
      </button>
      <button class="btn btn-ghost btn-sm" id="btn-test-entry" style="display:none;">
        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 12l2 2 4-4"/><path d="M12 2a10 10 0 1 0 10 10A10 10 0 0 0 12 2z"/></svg>
        Send Test Entry
      </button>
      <div style="flex:1;"></div>
      <button class="btn btn-outline" onclick="closeModal('company-modal')">Cancel</button>
      <button class="btn btn-primary" id="btn-save-company">Save</button>
    </div>
  </div>
</div>

<!-- Sync Logs Modal -->
<div class="modal-overlay" id="sync-logs-modal">
  <div class="modal" style="width:42rem;">
    <div class="modal-header">
      <div>
        <div class="modal-title">Sync Logs</div>
        <div class="modal-desc">Recent sync activity for this company</div>
      </div>
      <button class="btn-icon" onclick="closeModal('sync-logs-modal')">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
      </button>
    </div>
    <div class="modal-body" style="padding:0;">
      <div class="table-wrap" style="border:none;border-radius:0;">
        <table>
          <thead><tr><th>Type</th><th>Status</th><th class="text-right">Records</th><th class="text-right">Duration</th><th>Started At</th><th>Error</th></tr></thead>
          <tbody id="sync-logs-table"></tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<!-- Connection Guide Modal -->
<div class="modal-overlay" id="guide-modal">
  <div class="modal" style="width:44rem;max-width:96vw;">
    <div class="modal-header">
      <div>
        <div class="modal-title">Setup & Connection Guide</div>
        <div class="modal-desc">API key, mock testing, and connecting to Tally Prime</div>
      </div>
      <button class="btn-icon" onclick="closeModal('guide-modal')">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
      </button>
    </div>
    <div class="modal-body" style="padding:1.25rem 1.5rem;">

      <!-- Step 0: API Key -->
      <div class="guide-step">
        <div class="guide-step-num" style="background:var(--primary);color:#fff;">ðŸ”‘</div>
        <div class="guide-step-body">
          <div class="guide-step-title">How the API Key Works</div>
          <div class="guide-step-desc">TallySync protects its backend with an API key so only your browser can talk to it.</div>
          <ul class="guide-list">
            <li>On first launch, the server <strong>auto-generates</strong> a random key and saves it to <code>server/api.key</code></li>
            <li>The key is shown in <strong>Settings â†’ API Key</strong> field â€” copy it once and it's stored in your browser</li>
            <li>Every API call your browser makes sends this key in an <code>X-API-Key</code> header</li>
            <li>If you ever reset the key: delete <code>server/api.key</code> and restart the server â€” a new key is generated</li>
          </ul>
          <div class="guide-tip">
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
            The key is stored only on your machine â€” it never leaves your LAN. You don't need to remember it.
          </div>
        </div>
      </div>

      <div class="guide-divider"></div>

      <!-- Test without Tally -->
      <div class="guide-step">
        <div class="guide-step-num" style="background:var(--success);color:#fff;">ðŸ§ª</div>
        <div class="guide-step-body">
          <div class="guide-step-title">Test Without Tally (Mock Mode)</div>
          <div class="guide-step-desc">No Tally Prime? Run the built-in mock server to test every feature with realistic demo data.</div>
          <ol class="guide-list">
            <li>Open a terminal and go to the <code>server/</code> folder</li>
            <li>Run: <code>python mock_tally.py</code></li>
            <li>In TallySync Settings â†’ Add Company:<br>
              <strong>Display Name:</strong> Demo Company<br>
              <strong>Tally Company Name:</strong> Demo Trading Co.<br>
              <strong>Host:</strong> localhost &nbsp; <strong>Port:</strong> 9000
            </li>
            <li>Click <strong>Test Connection</strong> â€” it should say "Connected"</li>
            <li>Save the company, then go to <strong>Inventory</strong> or <strong>Orders</strong></li>
          </ol>
          <div class="guide-tip">
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></svg>
            The mock server returns 8 stock items, 7 ledgers, and sample sales + purchase vouchers. Pushing an order always succeeds with a mock voucher number.
          </div>
        </div>
      </div>

      <div class="guide-divider"></div>

      <!-- Step 1: Enable HTTP Server -->
      <div class="guide-step">
        <div class="guide-step-num">1</div>
        <div class="guide-step-body">
          <div class="guide-step-title">Enable Tally Prime HTTP Server</div>
          <div class="guide-step-desc">This must be done on the PC where Tally is running.</div>
          <ol class="guide-list">
            <li>Open <strong>Tally Prime</strong> and load your company</li>
            <li>Press <kbd>F12</kbd> â†’ <strong>Advanced Configuration</strong></li>
            <li>Set <strong>Enable Tally HTTP Server</strong> to <strong>Yes</strong></li>
            <li>Set <strong>Tally HTTP Port</strong> to <code>9000</code> (or any free port)</li>
            <li>Press <strong>Accept</strong> â€” Tally will restart the HTTP listener</li>
          </ol>
        </div>
      </div>

      <div class="guide-divider"></div>

      <!-- Step 2a: Same PC -->
      <div class="guide-step">
        <div class="guide-step-num">2</div>
        <div class="guide-step-body">
          <div class="guide-step-title">Same PC Setup (most common)</div>
          <div class="guide-step-desc">TallySync and Tally are on the same computer.</div>
          <div class="guide-config-box">
            <div class="guide-config-row">
              <span class="guide-config-label">Host / IP</span>
              <code class="guide-config-val">localhost</code>
            </div>
            <div class="guide-config-row">
              <span class="guide-config-label">Port</span>
              <code class="guide-config-val">9000</code>
            </div>
          </div>
          <div class="guide-step-desc" style="margin-top:0.5rem;">No firewall changes needed for same-machine connections.</div>
        </div>
      </div>

      <div class="guide-divider"></div>

      <!-- Step 2b: LAN -->
      <div class="guide-step">
        <div class="guide-step-num">3</div>
        <div class="guide-step-body">
          <div class="guide-step-title">LAN Setup (Tally on a different PC)</div>
          <div class="guide-step-desc">TallySync runs on your machine, Tally runs on another PC in the same network.</div>
          <ol class="guide-list">
            <li>On the <strong>Tally PC</strong>, find its IP: open Command Prompt â†’ type <code>ipconfig</code> â†’ look for <strong>IPv4 Address</strong> (e.g. <code>192.168.1.10</code>)</li>
            <li>Make sure <strong>port 9000 is allowed</strong> through Windows Firewall on the Tally PC</li>
            <li>In TallySync, enter that IP as the <strong>Host</strong> and <code>9000</code> as the port</li>
          </ol>
          <div class="guide-config-box">
            <div class="guide-config-row">
              <span class="guide-config-label">Host / IP</span>
              <code class="guide-config-val">192.168.1.10</code>
              <span class="guide-config-note">(Tally PC's IP)</span>
            </div>
            <div class="guide-config-row">
              <span class="guide-config-label">Port</span>
              <code class="guide-config-val">9000</code>
            </div>
          </div>
        </div>
      </div>

      <div class="guide-divider"></div>

      <!-- Step 3: Multi-company -->
      <div class="guide-step">
        <div class="guide-step-num">4</div>
        <div class="guide-step-body">
          <div class="guide-step-title">Multi-Company Setup</div>
          <div class="guide-step-desc">To manage multiple Tally companies, add each one separately in TallySync.</div>
          <ul class="guide-list">
            <li>The <strong>Tally Company Name</strong> field must match <em>exactly</em> as it appears in Tally Prime (including capitalisation and spaces)</li>
            <li>All companies can share the same host and port â€” Tally serves them all from one HTTP server</li>
            <li>Each company gets its own sync schedule and cached data in TallySync</li>
          </ul>
          <div class="guide-tip">
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></svg>
            To find the exact company name: in Tally, go to <strong>Company â†’ Alter</strong> and copy the name exactly as shown.
          </div>
        </div>
      </div>

      <div class="guide-divider"></div>

      <!-- Quick test -->
      <div class="guide-step">
        <div class="guide-step-num">5</div>
        <div class="guide-step-body">
          <div class="guide-step-title">Quick Connection Test</div>
          <div class="guide-step-desc">Test your connection before saving a company.</div>
          <div style="display:flex;gap:0.75rem;align-items:center;margin-top:0.75rem;flex-wrap:wrap;">
            <input type="text"   id="probe-host" class="form-control" placeholder="localhost" value="localhost" style="width:11rem;">
            <input type="number" id="probe-port" class="form-control" value="9000" min="1" max="65535" style="width:6rem;">
            <button class="btn btn-primary btn-sm" id="btn-probe">Test Now</button>
          </div>
          <div id="probe-result" style="display:none;margin-top:0.75rem;padding:0.625rem 0.875rem;border-radius:calc(var(--radius) - 4px);font-size:0.8125rem;border:1px solid var(--border);"></div>
        </div>
      </div>

    </div>
    <div class="modal-footer">
      <button class="btn btn-primary" onclick="closeModal('guide-modal')">Got it</button>
    </div>
  </div>
</div>

<!-- macOS Launcher Detail Modal -->
<div class="modal-overlay" id="launcher-mac-modal">
  <div class="modal" style="width:38rem;max-width:96vw;">
    <div class="modal-header">
      <div>
        <div class="modal-title">macOS Setup â€” TallySync.app</div>
        <div class="modal-desc">Start TallySync with a double-click on Mac</div>
      </div>
      <button class="btn-icon" onclick="closeModal('launcher-mac-modal')">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
      </button>
    </div>
    <div class="modal-body">
      <div class="guide-step">
        <div class="guide-step-num" style="background:var(--primary);color:#fff;">1</div>
        <div class="guide-step-body">
          <div class="guide-step-title">First-time setup (run once)</div>
          <ol class="guide-list">
            <li>Download &amp; unzip the TallySync package from GitHub</li>
            <li>Open <strong>Terminal</strong> and run the setup:<br>
              <code>cd ~/Downloads/tallysync-manager</code><br>
              <code>python3 -m venv server/.venv</code><br>
              <code>server/.venv/bin/pip install -r server/requirements.txt</code>
            </li>
          </ol>
        </div>
      </div>
      <div class="guide-divider"></div>
      <div class="guide-step">
        <div class="guide-step-num" style="background:var(--primary);color:#fff;">2</div>
        <div class="guide-step-body">
          <div class="guide-step-title">Install the app</div>
          <ol class="guide-list">
            <li>Drag <strong>TallySync.app</strong> from the download folder to <strong>/Applications</strong></li>
            <li><strong>First launch only:</strong> right-click the app â†’ <strong>Open</strong> â†’ click <strong>Open</strong> again in the dialog that appears</li>
            <li>From now on, just double-click it normally</li>
          </ol>
          <div class="guide-tip" style="background:oklch(0.97 0.02 27);border-color:oklch(0.577 0.245 27 / 25%);gap:0.625rem;align-items:flex-start;">
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="oklch(0.55 0.22 27)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="flex-shrink:0;margin-top:1px"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
            <span style="color:var(--foreground);">Getting <em>"Apple could not verifyâ€¦"</em>? Open <strong>Terminal</strong> and run this once:
            <code style="display:block;margin-top:0.4rem;padding:0.35rem 0.6rem;background:oklch(0.93 0.01 27);border-radius:4px;font-size:0.8rem;">xattr -cr /Applications/TallySync.app</code>
            Then double-click the app â€” it will open normally.</span>
          </div>
        </div>
      </div>
      <div class="guide-divider"></div>
      <div class="guide-step">
        <div class="guide-step-num" style="background:var(--success);color:#fff;">âœ“</div>
        <div class="guide-step-body">
          <div class="guide-step-title">Optional: auto-start on login</div>
          <div class="guide-step-desc">To have TallySync start automatically every time you log in, run this once in Terminal:</div>
          <code style="display:block;margin-top:0.5rem;padding:0.5rem 0.75rem;background:var(--muted);border-radius:6px;font-size:0.8125rem;">
            bash ~/Downloads/tallysync-manager/setup/install-autostart-macos.sh
          </code>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-primary" onclick="closeModal('launcher-mac-modal')">Got it</button>
    </div>
  </div>
</div>

<!-- Windows Launcher Detail Modal -->
<div class="modal-overlay" id="launcher-win-modal">
  <div class="modal" style="width:38rem;max-width:96vw;">
    <div class="modal-header">
      <div>
        <div class="modal-title">Windows Setup â€” start.bat</div>
        <div class="modal-desc">Start TallySync with a double-click on Windows</div>
      </div>
      <button class="btn-icon" onclick="closeModal('launcher-win-modal')">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
      </button>
    </div>
    <div class="modal-body">
      <div class="guide-step">
        <div class="guide-step-num" style="background:var(--primary);color:#fff;">1</div>
        <div class="guide-step-body">
          <div class="guide-step-title">First-time setup (run once)</div>
          <ol class="guide-list">
            <li>Download &amp; unzip the TallySync package from GitHub</li>
            <li>Open <strong>Command Prompt</strong> and run:<br>
              <code>cd C:\Users\YourName\Downloads\tallysync-manager</code><br>
              <code>python -m venv server\.venv</code><br>
              <code>server\.venv\Scripts\pip install -r server\requirements.txt</code>
            </li>
          </ol>
          <div class="guide-tip">
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></svg>
            Don't have Python? Download it from <strong>python.org</strong> â€” make sure to tick "Add Python to PATH" during install.
          </div>
        </div>
      </div>
      <div class="guide-divider"></div>
      <div class="guide-step">
        <div class="guide-step-num" style="background:var(--primary);color:#fff;">2</div>
        <div class="guide-step-body">
          <div class="guide-step-title">Create a desktop shortcut</div>
          <ol class="guide-list">
            <li>Open the <strong>setup\</strong> folder inside the TallySync package</li>
            <li>Right-click <strong>start.bat</strong> â†’ <strong>Send to</strong> â†’ <strong>Desktop (create shortcut)</strong></li>
            <li>Double-click the shortcut on your desktop â€” both servers start and your browser opens</li>
          </ol>
        </div>
      </div>
      <div class="guide-divider"></div>
      <div class="guide-step">
        <div class="guide-step-num" style="background:var(--success);color:#fff;">âœ“</div>
        <div class="guide-step-body">
          <div class="guide-step-title">Optional: auto-start on login</div>
          <div class="guide-step-desc">To have TallySync start automatically every time Windows starts, double-click this once:</div>
          <code style="display:block;margin-top:0.5rem;padding:0.5rem 0.75rem;background:var(--muted);border-radius:6px;font-size:0.8125rem;">
            setup\install-autostart-windows.bat
          </code>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-primary" onclick="closeModal('launcher-win-modal')">Got it</button>
    </div>
  </div>
</div>

<script src="../assets/js/config.js"></script>
<script src="../assets/js/api.js"></script>
<script src="../assets/js/utils.js"></script>
<script src="../assets/js/sync.js"></script>
<script src="../assets/js/layout.js"></script>
<script src="../assets/js/pages/settings.js"></script>
<script>
  injectLayout('Settings');
  initSettings();
</script>
</body>
</html>
